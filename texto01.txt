This is a modification by Esteban.